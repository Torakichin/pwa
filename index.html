<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Music Player</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#302b63">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        /* CSSは変更なしのため省略（そのままお使いください） */
        :root { --primary-color: #00d2ff; --accent-color: #ff6800; --bg-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e); --glass-bg: rgba(255, 255, 255, 0.1); --text-color: #ffffff; }
        body { margin: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg-gradient); background-attachment: fixed; height: 100vh; display: flex; align-items: center; justify-content: center; color: var(--text-color); }
        .appframe { background: var(--glass-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); width: 380px; padding: 30px; border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 25px 45px rgba(0, 0, 0, 0.3); text-align: center; }
        h1 { font-size: 1.5rem; margin-bottom: 20px; font-weight: 300; letter-spacing: 2px; color: var(--primary-color); text-shadow: 0 0 10px rgba(0, 210, 255, 0.5); }
        .visualizer { width: 150px; height: 150px; margin: 0 auto 20px; border-radius: 50%; overflow: hidden; border: 4px solid var(--glass-bg); box-shadow: 0 0 20px rgba(0,0,0,0.2); transition: transform 0.5s ease; }
        .visualizer img { width: 100%; height: 100%; object-fit: cover; }
        .playing-art { animation: rotate 10s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        audio { width: 100%; height: 40px; margin-bottom: 20px; filter: invert(100%) hue-rotate(180deg) brightness(1.5); }
        .controls-info { font-size: 0.9rem; margin-bottom: 20px; opacity: 0.8; }
        #random { color: var(--primary-color); text-decoration: none; font-weight: bold; border: 1px solid var(--primary-color); padding: 2px 10px; border-radius: 12px; margin-left: 8px; transition: all 0.3s; }
        #random:hover { background: var(--primary-color); color: #000; }
        ul { list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto; text-align: left; }
        ul::-webkit-scrollbar { width: 5px; }
        ul::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        li { padding: 12px 15px; margin-bottom: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; border: 1px solid transparent; }
        li:hover { background: rgba(255, 255, 255, 0.15); transform: translateX(5px); }
        li::before { content: '▶'; font-size: 0.7rem; margin-right: 10px; opacity: 0.5; }
        li.active { background: rgba(0, 210, 255, 0.2); border: 1px solid var(--primary-color); color: var(--primary-color); font-weight: bold; }
        li.active::before { content: '♫'; opacity: 1; color: var(--primary-color); }
    </style>
</head>
<body>

    <div class="appframe">
        <h1>Music Player</h1>
        
        <div class="visualizer" id="artWrapper">
            <img id="statusImg" src="pict_stop.png" alt="再生状態">
        </div>

        <audio id="mainAudio" src="bgm1.mp3" controls></audio>
        
        <p class="controls-info">
            Select a track or <a id="random" href="#">Random Play</a>
        </p>

        <ul id="playlist">
            <li data-file="IRIS OUT.mp3" class="active">IRIS OUT</li>
            <li data-file="カリスマックス.mp3">カリスマックス</li>
            <li data-file="シルエット.mp3">シルエット</li>
            <li data-file="ライラック.mp3">ライラック</li>
            <li data-file="唱.mp3">唱</li>
            <li data-file="夜に駆ける.mp3">夜に駆ける</li>
        </ul>
    </div>

    <script>
        /* サービスワーカーの登録 */
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.err('SW registration failed:', err));
            });
        }

        /* --- ロジック設定 --- */
        const audio = document.getElementById('mainAudio');
        const listitems = document.querySelectorAll('li');
        const img = document.getElementById('statusImg');
        const artWrapper = document.getElementById('artWrapper');
        const randomBtn = document.querySelector('#random');

        listitems.forEach(item => {
            item.addEventListener('click', () => playMusic(item));
        });

        function playMusic(li) {
            const file = li.getAttribute('data-file');
            audio.setAttribute('src', file);
            audio.play();
            document.querySelector('.active').classList.remove('active');
            li.classList.add('active');
        }

        audio.addEventListener('play', () => {
            img.setAttribute('src', 'pict_play.png');
            artWrapper.classList.add('playing-art');
        });

        audio.addEventListener('pause', () => {
            img.setAttribute('src', 'pict_stop.png');
            artWrapper.classList.remove('playing-art');
        });

        audio.addEventListener('ended', () => {
            const activeLi = document.querySelector('.active');
            const nextLi = activeLi.nextElementSibling;
            if (nextLi) playMusic(nextLi);
        });

        randomBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const rnd = Math.floor(Math.random() * listitems.length);
            playMusic(listitems[rnd]);
        });
    </script>
</body>
</html>
